# StateManager Snapshots Documentation

This document provides a comprehensive overview of the `StateManager` snapshot system, which is a core component of the application's state management architecture.

## Overview

A `StateManager` snapshot is a read-only, point-in-time representation of the entire game state. It is generated by the `StateManager` running in the Web Worker and sent to the main UI thread. This mechanism allows UI components to access and display game state information without directly interacting with the `StateManager` or freezing the UI with complex computations.

Snapshots are the "single source of truth" for the UI. When any part of the game state changes (e.g., a player collects an item, checks a location), the `StateManager` generates a new snapshot and broadcasts it. UI modules listen for these updates and re-render themselves accordingly.

## Snapshot Generation

The snapshot is generated by the `getSnapshot()` method within the `frontend/modules/stateManager/stateManager.js` file. This method gathers data from various parts of the `StateManager`, including the inventory, region reachability, and game-specific state, and assembles it into a single, comprehensive object.

## Snapshot Data Structure

The snapshot object contains the following key properties. Each property provides a different slice of the overall game state.

### `inventory`

- **Type**: `Object`
- **Description**: A key-value map where keys are the names of items the player currently possesses, and values are their respective counts. This reflects the player's full inventory.
- **Example**: `{ "Progressive Sword": 2, "Bow": 1, "Hookshot": 1 }`

### `settings`

- **Type**: `Object`
- **Description**: A complete copy of the application and game-specific settings currently in effect. This includes things like game logic variations (`swordless` mode), UI preferences, etc.

### `flags`

- **Type**: `Array<string>`
- **Description**: An array of strings representing active game-specific state flags. These are often used for tracking story progression or world states that aren't represented by items.

### `checkedLocations`

- **Type**: `Array<string>`
- **Description**: A list of all location names that the player has marked as "checked" or "visited".

### `state`

- **Type**: `Object`
- **Description**: Contains game-specific state information that doesn't fit into other categories. This can include the status of dungeons (e.g., which bosses are defeated), current game modes, and other dynamic data.

### `reachability`

- **Type**: `Object`
- **Description**: A crucial map where keys are the names of all locations and regions in the game. The value for each key is a string indicating its current accessibility status:
  - `'reachable'`: The player can currently access this location or region.
  - `'unreachable'`: The player cannot currently access this location or region.
  - `'checked'`: The location has been checked. (Regions are not marked as 'checked').

### `locationItems`

- **Type**: `Object`
- **Description**: A map where keys are location names and values are objects describing the item at that location (e.g., `{ name: 'Heart Container', player: 1 }`). This allows the UI to know what item is at each location.

### `player`

- **Type**: `Object`
- **Description**: Contains information about the current player, including:
  - `name`: The player's name.
  - `slot`: The player's slot number in a multi-world game.
  - `team`: The player's team number.

### `game`

- **Type**: `string`
- **Description**: An identifier for the current game being played, such as `"A Link to the Past"` or `"Adventure"`.

### `difficultyRequirements`

- **Type**: `Object`
- **Description**: Contains settings and values related to game difficulty, which might affect item requirements or other logic.

### `shops`

- **Type**: `Object`
- **Description**: Data related to the state and contents of in-game shops, if applicable to the a user game.

### `gameMode`

- **Type**: `string`
- **Description**: The specific mode of the game being played (e.g., "Archipelago Loops").

### `dungeons`

- **Type**: `Object`
- **Description**: Contains detailed information about the dungeons in the game, including their state, items, and bosses.

---

This detailed snapshot structure ensures that the UI has all the necessary information to render a complete and accurate view of the game world for the user.
