That's the end of the files you need for context.  Now here are your instructions:

The most recent change we made was updating the javascript frontend to use the same BFS region traversal logic as the Python backend.

That brought the failed test cases down to 8, a new record.

These are the cases that still failed:

Bombos Tablet    Bombos Tablet Ledge    ❌ FAIL    Accessible    Moon Pearl, Magic Mirror, Book of Mudora, Progressive Sword, Progressive Sword, Progressive Glove, Progressive Glove    None    Expected: true, Got: false
Bombos Tablet    Bombos Tablet Ledge    ❌ FAIL    Accessible    Moon Pearl, Magic Mirror, Book of Mudora, Progressive Sword, Progressive Sword, Progressive Glove, Hammer    None    Expected: true, Got: false
Bombos Tablet    Bombos Tablet Ledge    ❌ FAIL    Accessible    Moon Pearl, Magic Mirror, Book of Mudora, Progressive Sword, Progressive Sword, Beat Agahnim 1, Hammer    None    Expected: true, Got: false
Bombos Tablet    Bombos Tablet Ledge    ❌ FAIL    Accessible    Moon Pearl, Magic Mirror, Book of Mudora, Progressive Sword, Progressive Sword, Beat Agahnim 1, Progressive Glove, Hookshot    None    Expected: true, Got: false
Bombos Tablet    Bombos Tablet Ledge    ❌ FAIL    Accessible    Moon Pearl, Magic Mirror, Book of Mudora, Progressive Sword, Progressive Sword, Beat Agahnim 1, Flippers, Hookshot    None    Expected: true, Got: false

Checkerboard Cave    Checkerboard Cave    ❌ FAIL    Accessible    Flute, Magic Mirror, Progressive Glove, Progressive Glove    None    Expected: true, Got: false

Desert Ledge    Desert Ledge    ❌ FAIL    Accessible    Flute, Magic Mirror, Progressive Glove, Progressive Glove    None    Expected: true, Got: false

Sunken Treasure    Light World    ❌ FAIL    Accessible    None    None    Expected: true, Got: false

It looks like these failed cases all involve event items.

We already knew that the event item logic wasn't implemented yet, and now fixing that is our next priority.

We attempted to implement the event item logic, but that is currently unfinished and our attempts so far have only introduced more errors.

The latest version of the code has 25 failed cases, and also the tests run much faster than the previous version, suggesting that something important is being skipped.

Some more information about event items:

We have code in exporter.py to include event items in the rules.json file.

Here is that code:

    # Then add event flags
    from worlds.alttp.Items import item_table
    from BaseClasses import ItemClassification

    for item_name, item_data in item_table.items():
        if item_data.type == 'Event':
            items_data[item_name] = {
                'name': item_name,
                'id': None,
                'groups': [],
                'advancement': item_data.classification == ItemClassification.progression,
                'priority': False,
                'useful': False,
                'trap': False
            }

Here is the json data we get for the event items:

      "Apple": {
        "name": "Apple",
        "id": 180,
        "groups": [
          "Everything",
          "Non Progression Items"
        ],
        "advancement": false,
        "priority": false,
        "useful": false,
        "trap": false
      },
      "Red Potion": {
        "name": "Red Potion",
        "id": 46,
        "groups": [
          "Everything",
          "Non Progression Items",
          "Potions"
        ],
        "advancement": false,
        "priority": false,
        "useful": false,
        "trap": false
      },
      "Green Potion": {
        "name": "Green Potion",
        "id": 47,
        "groups": [
          "Everything",
          "Non Progression Items",
          "Potions"
        ],
        "advancement": false,
        "priority": false,
        "useful": false,
        "trap": false
      },
      "Blue Potion": {
        "name": "Blue Potion",
        "id": 48,
        "groups": [
          "Everything",
          "Non Progression Items",
          "Potions"
        ],
        "advancement": false,
        "priority": false,
        "useful": false,
        "trap": false
      },
      "Bee": {
        "name": "Bee",
        "id": 14,
        "groups": [
          "Everything",
          "Non Progression Items"
        ],
        "advancement": false,
        "priority": false,
        "useful": false,
        "trap": false
      },
      "Small Heart": {
        "name": "Small Heart",
        "id": 66,
        "groups": [
          "Everything",
          "Non Progression Items"
        ],
        "advancement": false,
        "priority": false,
        "useful": false,
        "trap": false
      },
      "Activated Flute": {
        "name": "Activated Flute",
        "id": 74,
        "groups": [
          "Everything",
          "Progression Items"
        ],
        "advancement": true,
        "priority": false,
        "useful": false,
        "trap": false
      },
      "Beat Agahnim 1": {
        "name": "Beat Agahnim 1",
        "id": null,
        "groups": [],
        "advancement": true,
        "priority": false,
        "useful": false,
        "trap": false
      },
      "Beat Agahnim 2": {
        "name": "Beat Agahnim 2",
        "id": null,
        "groups": [],
        "advancement": true,
        "priority": false,
        "useful": false,
        "trap": false
      },
      "Get Frog": {
        "name": "Get Frog",
        "id": null,
        "groups": [],
        "advancement": true,
        "priority": false,
        "useful": false,
        "trap": false
      },
      "Return Smith": {
        "name": "Return Smith",
        "id": null,
        "groups": [],
        "advancement": true,
        "priority": false,
        "useful": false,
        "trap": false
      },
      "Pick Up Purple Chest": {
        "name": "Pick Up Purple Chest",
        "id": null,
        "groups": [],
        "advancement": true,
        "priority": false,
        "useful": false,
        "trap": false
      },
      "Open Floodgate": {
        "name": "Open Floodgate",
        "id": null,
        "groups": [],
        "advancement": true,
        "priority": false,
        "useful": false,
        "trap": false
      },
      "Capacity Upgrade Shop": {
        "name": "Capacity Upgrade Shop",
        "id": null,
        "groups": [],
        "advancement": true,
        "priority": false,
        "useful": false,
        "trap": false
      }
    }
  },

In rules.json, all events have an "event" entry, but it's false for every single location:

            "progress_type": 1,
            "event": false,
            "locked": false,
            "item": null

There are some locations that are labeled as events:

        "locations": [
          {
            "name": "Floodgate",
            "address": null,
            "crystal": false,
            "access_rule": {
              "type": "constant",
              "value": true
            },
            "item_rule": {
              "type": "constant",
              "value": true
            },
            "progress_type": 1,
            "event": false,
            "locked": true,
            "item": {
              "name": "Open Floodgate",
              "player": 1,
              "advancement": true,
              "priority": null,
              "type": "Event",
              "code": null
            }
          },

I think this is the way the event flags are supposed to be set.  Here are the other event locations I found in rules.json:

          {
            "name": "Missing Smith",
            "address": null,
            "crystal": false,
            "access_rule": {
              "type": "and",
              "conditions": [
                {
                  "type": "item_check",
                  "item": "Get Frog"
                },
                {
                  "type": "state_method",
                  "method": "can_reach",
                  "args": [
                    "Blacksmiths Hut",
                    "Region",
                    "player"
                  ]
                }
              ]
            },
            "item_rule": {
              "type": "constant",
              "value": true
            },
            "progress_type": 1,
            "event": false,
            "locked": true,
            "item": {
              "name": "Return Smith",
              "player": 1,
              "advancement": true,
              "priority": null,
              "type": "Event",
              "code": null
            }
          }

          {
            "name": "Capacity Upgrade Shop",
            "address": null,
            "crystal": false,
            "access_rule": {
              "type": "constant",
              "value": true
            },
            "item_rule": {
              "type": "constant",
              "value": true
            },
            "progress_type": 1,
            "event": false,
            "locked": true,
            "item": {
              "name": "Capacity Upgrade Shop",
              "player": 1,
              "advancement": true,
              "priority": null,
              "type": "Event",
              "code": null
            }
          },

          {
            "name": "Frog",
            "address": null,
            "crystal": false,
            "access_rule": {
              "type": "and",
              "conditions": [
                {
                  "type": "helper",
                  "name": "rule",
                  "args": []
                },
                {
                  "type": "helper",
                  "name": "old_rule",
                  "args": []
                }
              ]
            },
            "item_rule": {
              "type": "constant",
              "value": true
            },
            "progress_type": 1,
            "event": false,
            "locked": true,
            "item": {
              "name": "Get Frog",
              "player": 1,
              "advancement": true,
              "priority": null,
              "type": "Event",
              "code": null
            }
          }

I also notice that that last location has the issue of "rule" and "old rule" appearing in the conditions.  That means that there is a case that exporter.py isn't handling properly.  I don't know if that's related to the issues we're currently trying to fix.



